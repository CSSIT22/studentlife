name: Generate ER Diagram

on:
    push:
        branches:
            - DB

jobs:
    genER:
        runs-on: ubuntu-latest
        environment: DB
        steps:
            - name: Checkout
              uses: actions/checkout@v3
            - name: Read Schema
              id: schema
              uses: juliangruber/read-file-action@v1
              with:
                  path: ./backend/prisma/schema.prisma
            - name: Make request
              id: request
              uses: fjogeleit/http-request-action@v1
              with:
                  url: "${{secrets.API_URL}}"
                  method: "POST"
                  customHeaders: '{"Content-Type": "text/plain"}'
                  data: "${{ steps.schema.outputs.content }}"
            - name: Get Er
              run: echo ${{ steps.request.outputs.response }}
